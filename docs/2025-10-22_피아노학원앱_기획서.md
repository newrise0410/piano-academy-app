# 피아노 학원 관리 앱 상세 기획서 및 개발자 문서

**작성일**: 2025년 10월 22일
**버전**: 1.0
**작성자**: Piano Academy Development Team

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택](#2-기술-스택)
3. [시스템 아키텍처](#3-시스템-아키텍처)
4. [데이터베이스 구조](#4-데이터베이스-구조)
5. [인증 시스템](#5-인증-시스템)
6. [선생님 기능](#6-선생님-기능)
7. [학부모 기능](#7-학부모-기능)
8. [서비스 및 API](#8-서비스-및-api)
9. [상태 관리](#9-상태-관리)
10. [설치 및 설정](#10-설치-및-설정)
11. [주요 기능 구현 세부사항](#11-주요-기능-구현-세부사항)
12. [향후 개발 계획](#12-향후-개발-계획)

---

## 1. 프로젝트 개요

### 1.1 프로젝트 소개

**피아노 학원 관리 앱**은 피아노 학원의 운영을 효율화하고 선생님과 학부모 간의 원활한 소통을 지원하는 모바일 애플리케이션입니다.

### 1.2 개발 목적 및 배경

- **학원 운영 효율화**: 출석 관리, 수강료 관리, 학생 정보 관리를 통합
- **소통 강화**: 실시간 알림장 및 댓글 시스템으로 선생님-학부모 간 소통
- **AI 활용**: Google Gemini를 활용한 수업 일지 및 알림장 작성 자동화
- **모바일 최적화**: 언제 어디서나 접근 가능한 모바일 환경

### 1.3 주요 타겟 사용자

#### 선생님 (Teacher)
- 학생 관리 (등록, 수정, 삭제)
- 출석 체크 및 회차권 관리
- 알림장 발송
- 수업 일지 작성
- 수강료 관리
- 통계 확인

#### 학부모 (Parent)
- 자녀의 출석 현황 조회
- 알림장 확인 및 댓글
- 수업 일지 열람
- 수강료 확인
- 진도 현황 파악

### 1.4 핵심 가치

1. **효율성**: 반복적인 업무 자동화 (회차권 차감, AI 메모 생성)
2. **투명성**: 실시간 데이터 동기화 및 읽음 확인
3. **편의성**: 직관적인 UI/UX
4. **확장성**: 향후 기능 추가 용이한 아키텍처

---

## 2. 기술 스택

### 2.1 Frontend

| 기술 | 버전 | 용도 |
|------|------|------|
| React Native | 0.76.9 | 크로스 플랫폼 모바일 앱 개발 |
| Expo | 52.0.11 | 개발 환경 및 빌드 |
| React Navigation | 7.x | 화면 네비게이션 |
| NativeWind | 4.2.1 | Tailwind CSS 기반 스타일링 |
| Zustand | 5.0.8 | 상태 관리 |

### 2.2 Backend & Infrastructure

| 기술 | 버전 | 용도 |
|------|------|------|
| Firebase Firestore | 12.4.0 | NoSQL 데이터베이스 |
| Firebase Storage | 12.4.0 | 미디어 파일 저장 |
| Firebase Auth | 12.4.0 | 사용자 인증 |
| Expo Notifications | - | 푸시 알림 |

### 2.3 AI & 외부 API

| 기술 | 버전 | 용도 |
|------|------|------|
| Google Gemini API | 1.5 Flash/Pro | AI 메모 생성, 알림장 작성 |

### 2.4 주요 라이브러리

```json
{
  "expo-image-picker": "~16.0.3",     // 이미지/비디오 선택
  "expo-file-system": "~18.0.12",     // 파일 시스템
  "expo-device": "~17.0.6",           // 디바이스 정보
  "react-native-chart-kit": "^6.12.0", // 차트
  "@react-native-async-storage/async-storage": "^1.23.1" // 로컬 저장소
}
```

---

## 3. 시스템 아키텍처

### 3.1 전체 구조

```
┌─────────────────────────────────────────────────────────┐
│                     Client (Mobile)                      │
│  ┌──────────────────────────────────────────────────┐  │
│  │          React Native + Expo App                 │  │
│  │  ┌──────────────┐  ┌──────────────┐             │  │
│  │  │   Teacher    │  │    Parent    │             │  │
│  │  │   Screens    │  │   Screens    │             │  │
│  │  └──────────────┘  └──────────────┘             │  │
│  │         │                  │                     │  │
│  │         └──────────┬───────┘                     │  │
│  │                    │                             │  │
│  │         ┌──────────▼──────────┐                  │  │
│  │         │   Zustand Stores    │                  │  │
│  │         └──────────┬──────────┘                  │  │
│  │                    │                             │  │
│  │         ┌──────────▼──────────┐                  │  │
│  │         │   Repositories      │                  │  │
│  │         └──────────┬──────────┘                  │  │
│  │                    │                             │  │
│  │         ┌──────────▼──────────┐                  │  │
│  │         │      Services       │                  │  │
│  │         └──────────┬──────────┘                  │  │
│  └────────────────────┼──────────────────────────────┘  │
└────────────────────────┼──────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│   Firebase   │ │   Firebase   │ │   Gemini     │
│  Firestore   │ │   Storage    │ │     API      │
└──────────────┘ └──────────────┘ └──────────────┘
```

### 3.2 디렉토리 구조

```
piano-academy-app/
├── src/
│   ├── components/          # 재사용 가능한 컴포넌트
│   │   ├── common/          # 공통 컴포넌트
│   │   │   ├── Text.js
│   │   │   ├── Button.js
│   │   │   ├── FormInput.js
│   │   │   ├── MediaPicker.js
│   │   │   ├── CommentSection.js
│   │   │   └── ...
│   │   ├── teacher/         # 선생님 전용 컴포넌트
│   │   └── parent/          # 학부모 전용 컴포넌트
│   │
│   ├── screens/             # 화면 컴포넌트
│   │   ├── auth/            # 인증 화면
│   │   ├── teacher/         # 선생님 화면 (16개)
│   │   └── parent/          # 학부모 화면 (8개)
│   │
│   ├── navigation/          # 네비게이션 설정
│   │   ├── AppNavigator.js
│   │   ├── TeacherNavigator.js
│   │   └── ParentNavigator.js
│   │
│   ├── services/            # 비즈니스 로직 및 API
│   │   ├── firestoreService.js        # Firestore CRUD
│   │   ├── pushNotificationService.js # 푸시 알림
│   │   ├── geminiService.js           # AI 통합
│   │   ├── authService.js             # 인증
│   │   └── dashboardService.js        # 대시보드
│   │
│   ├── repositories/        # 데이터 접근 계층
│   │   ├── StudentRepository.js
│   │   ├── AttendanceRepository.js
│   │   ├── NoticeRepository.js
│   │   └── ...
│   │
│   ├── store/               # Zustand 상태 관리
│   │   ├── authStore.js
│   │   ├── studentStore.js
│   │   ├── attendanceStore.js
│   │   ├── noticeStore.js
│   │   └── ...
│   │
│   ├── config/              # 설정 파일
│   │   └── firebase.js
│   │
│   ├── styles/              # 스타일 정의
│   │   └── teacher_colors.js
│   │
│   └── utils/               # 유틸리티 함수
│
├── docs/                    # 문서
├── assets/                  # 이미지, 폰트 등
└── package.json
```

### 3.3 코드 아키텍처

#### Repository Pattern
- 데이터 접근 로직을 분리하여 Mock/Firebase/API 모드 지원
- 테스트 및 유지보수 용이

#### Service Layer
- 비즈니스 로직을 서비스 레이어에서 처리
- 화면 컴포넌트는 UI 로직에만 집중

#### State Management (Zustand)
- 전역 상태를 Zustand로 관리
- 간단하고 직관적인 API

---

## 4. 데이터베이스 구조

### 4.1 Firestore Collections

#### 4.1.1 students (학생)

```typescript
{
  id: string,
  teacherId: string,           // 담당 선생님 ID
  name: string,                // 학생 이름
  parentName: string,          // 학부모 이름
  parentPhone: string,         // 학부모 연락처
  level: string,               // 수준 (초급/중급/고급)
  category: string,            // 카테고리 (초등/고등/성인)
  schedule: string,            // 수업 일정 (예: "월/수 16:00")

  // 수강권 정보
  ticketType: 'count' | 'period',  // 회차권/기간권
  ticketCount: number,         // 남은 회차 (회차권인 경우)
  ticketPeriod: {              // 수강 기간 (기간권인 경우)
    start: string,             // YYYY-MM-DD
    end: string                // YYYY-MM-DD
  },

  // 수강료 정보
  tuitionFee: number,          // 월 수강료
  paymentDate: string,         // 납부일 (예: "매월 5일")
  isPaid: boolean,             // 이번 달 납부 여부

  memo: string,                // 학생 전반 메모
  pushToken: string,           // 푸시 알림 토큰 (학부모용)

  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### 4.1.2 attendance (출석)

```typescript
{
  id: string,
  studentId: string,           // 학생 ID
  studentName: string,         // 학생 이름
  teacherId: string,           // 선생님 ID
  date: string,                // 날짜 (YYYY-MM-DD)
  status: 'present' | 'absent' | 'makeup',  // 출석/결석/보강
  note: string,                // 메모
  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### 4.1.3 lessonNotes (수업 일지)

```typescript
{
  id: string,
  studentId: string,           // 학생 ID
  teacherId: string,           // 선생님 ID
  date: string,                // 날짜 (YYYY-MM-DD)
  progress: string,            // 진도
  practice: string,            // 연습 과제
  memo: string,                // 메모 (AI 생성 가능)
  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### 4.1.4 notices (알림장)

```typescript
{
  id: string,
  teacherId: string,           // 발송한 선생님 ID
  title: string,               // 제목
  content: string,             // 내용
  date: string,                // 발송 날짜 (YYYY.MM.DD)
  time: string,                // 발송 시간 (HH:mm)

  recipients: string[],        // 수신 학생 ID 배열
  confirmed: number,           // 확인한 학생 수
  total: number,               // 전체 수신자 수

  readBy: Array<{              // 읽음 확인 배열
    studentId: string,
    readAt: timestamp
  }>,

  media: Array<{               // 첨부 미디어
    url: string,               // Firebase Storage URL
    type: 'image' | 'video'
  }>,

  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### 4.1.5 comments (댓글)

```typescript
{
  id: string,
  noticeId: string,            // 알림장 ID
  userId: string,              // 작성자 ID
  userName: string,            // 작성자 이름
  userType: 'teacher' | 'parent',  // 작성자 유형
  content: string,             // 댓글 내용
  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### 4.1.6 makeupLessons (보강 수업)

```typescript
{
  id: string,
  teacherId: string,
  studentId: string,
  studentName: string,
  originalDate: string,        // 원래 수업 날짜
  makeupDate: string,          // 보강 날짜 (YYYY-MM-DD)
  time: string,                // 보강 시간
  reason: string,              // 보강 사유
  status: 'pending' | 'completed' | 'cancelled',
  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### 4.1.7 tuition (수강료)

```typescript
{
  id: string,
  teacherId: string,
  studentId: string,
  studentName: string,
  amount: number,              // 금액
  month: string,               // 해당 월 (YYYY-MM)
  paymentDate: string,         // 납부일
  status: 'paid' | 'unpaid' | 'overdue',
  method: string,              // 납부 방법
  memo: string,
  createdAt: timestamp,
  updatedAt: timestamp
}
```

#### 4.1.8 activities (활동 로그)

```typescript
{
  id: string,
  teacherId: string,
  type: string,                // 활동 유형 (notice, student, attendance 등)
  action: string,              // 액션 설명
  studentName: string,         // 관련 학생
  details: string,             // 상세 내용
  icon: string,                // 아이콘 이름
  color: string,               // 색상
  createdAt: timestamp
}
```

#### 4.1.9 gallery (갤러리)

```typescript
{
  id: string,
  teacherId: string,
  title: string,               // 제목
  description: string,         // 설명
  images: string[],            // 이미지 URL 배열
  date: string,                // 날짜
  category: string,            // 카테고리
  createdAt: timestamp,
  updatedAt: timestamp
}
```

### 4.2 데이터베이스 관계도

```
teachers (Firebase Auth)
    │
    ├──── students
    │       │
    │       ├──── attendance
    │       ├──── lessonNotes
    │       └──── tuition
    │
    ├──── notices
    │       │
    │       └──── comments
    │
    ├──── makeupLessons
    ├──── activities
    └──── gallery
```

---

## 5. 인증 시스템

### 5.1 회원가입 플로우

#### 선생님 회원가입
1. **역할 선택** (`RoleSelectScreen.js`)
   - "선생님" 선택

2. **선생님 정보 입력** (`SignupTeacherScreen.js`)
   ```
   - 이메일
   - 비밀번호
   - 이름
   - 전화번호
   - 학원 이름
   ```

3. **Firebase Auth 계정 생성**
   - `authService.signupTeacher()`
   - Firestore `teachers` 컬렉션에 추가 정보 저장

4. **자동 로그인**
   - `authStore` 업데이트
   - 선생님 대시보드로 이동

#### 학부모 회원가입
1. **역할 선택** (`RoleSelectScreen.js`)
   - "학부모" 선택

2. **학부모 정보 입력** (`SignupParentScreen.js`)
   ```
   - 이메일
   - 비밀번호
   - 이름
   - 전화번호
   - 자녀 연결 코드 (향후 구현)
   ```

3. **Firebase Auth 계정 생성**
   - `authService.signupParent()`
   - Firestore `parents` 컬렉션에 추가 (향후 구현)

4. **자동 로그인**
   - `authStore` 업데이트
   - 학부모 홈으로 이동

### 5.2 로그인 플로우

**파일**: `src/screens/auth/LoginScreen.js`

1. 이메일/비밀번호 입력
2. `authService.login()` 호출
3. Firebase Auth 검증
4. 사용자 정보 로드
5. `authStore` 업데이트
6. 역할에 따라 네비게이션:
   - 선생님 → Teacher Navigator
   - 학부모 → Parent Navigator

### 5.3 비밀번호 찾기

**파일**: `src/screens/auth/FindPasswordScreen.js`

1. 이메일 입력
2. Firebase Auth `sendPasswordResetEmail()` 호출
3. 비밀번호 재설정 이메일 발송
4. 사용자가 이메일 링크로 비밀번호 재설정

### 5.4 로그아웃

```javascript
const logout = async () => {
  await signOut(auth);
  authStore.clearUser();
  navigation.navigate('Login');
};
```

### 5.5 인증 상태 관리

**파일**: `src/store/authStore.js`

```javascript
const useAuthStore = create((set) => ({
  user: null,
  isAuthenticated: false,
  loading: true,

  setUser: (user) => set({ user, isAuthenticated: true, loading: false }),
  clearUser: () => set({ user: null, isAuthenticated: false, loading: false }),
  setLoading: (loading) => set({ loading }),
}));
```

---

## 6. 선생님 기능

### 6.1 대시보드

**파일**: `src/screens/teacher/DashboardScreen.js`

#### 주요 기능
1. **오늘의 출석 현황**
   - 오늘 수업이 있는 학생 수
   - 출석 완료 / 미완료
   - 빠른 출석 체크 링크

2. **미수금 학생 알림**
   - 이번 달 미납 학생 수
   - 금액 합계
   - 미수금 관리 화면으로 이동

3. **최근 활동**
   - 최근 5개 활동 표시
   - 알림장 발송, 학생 추가, 출석 체크 등

4. **주간 통계**
   - 출석률 그래프
   - 학생 수 추이

#### 코드 참조
- 출석 현황: `DashboardScreen.js:120-145`
- 미수금 알림: `DashboardScreen.js:180-210`
- 최근 활동: `DashboardScreen.js:245-280`

### 6.2 학생 관리

#### 6.2.1 학생 목록 (`StudentListScreen.js`)

**주요 기능**:
- 전체 학생 목록 표시
- 검색 (이름, 전화번호)
- 필터링:
  - 카테고리 (전체/초등/고등/성인)
  - 요일 (전체/월/화/수/목/금/토/일)
  - 수준 (전체/초급/중급/고급)
  - 미수금 (전체/미수금만)

**학생 카드 정보**:
- 이름, 레벨 배지
- 수업 일정
- 회차권 정보 (남은 횟수)
- 미수금 배지 (있는 경우)
- 회차권 소진 경고 (≤2회 시 빨간 배경)

**코드 참조**:
- 검색 로직: `StudentListScreen.js:85-105`
- 필터링: `StudentListScreen.js:150-180`
- 학생 카드: `src/components/teacher/StudentCard.js`

#### 6.2.2 학생 추가/수정 (`StudentFormScreen.js`)

**입력 필드**:
```
- 학생 이름 *
- 학부모 이름
- 학부모 연락처
- 수준 (초급/중급/고급) *
- 카테고리 (초등/고등/성인) *
- 수업 일정 * (예: 월/수 16:00)
- 수강권 종류 (회차권/기간권) *
- 회차권 횟수 또는 기간
- 월 수강료
- 납부일
- 메모
```

**유효성 검사**:
- 필수 항목 체크
- 전화번호 형식 검증
- 수강료 숫자 검증

**코드 참조**:
- 폼 검증: `StudentFormScreen.js:120-150`
- 저장: `StudentFormScreen.js:180-220`

#### 6.2.3 학생 상세 (`StudentDetailScreen.js`)

**탭 구조**:
1. **학생 정보**
   - 기본 정보
   - 수업 일정
   - 전반 메모
   - 최근 수업 일지 (5개)

2. **출석 기록**
   - 월별 출석 현황
   - 출석률 표시
   - 출석 히스토리

3. **수강료**
   - 회차권/기간권 관리
   - 회차권 충전 버튼 (+4회, +8회, +12회)
   - 납부 기록

**주요 기능**:
- 회차권 타입 변경 모달
- 회차권 충전
- 수업 일지 작성 바로가기
- 학생 정보 수정
- 학생 삭제

**코드 참조**:
- 회차권 관리: `StudentDetailScreen.js:220-265`
- 수업 일지 통합: `StudentDetailScreen.js:366-448`

### 6.3 출석 관리

**파일**: `src/screens/teacher/AttendanceScreen.js`

#### 주요 기능

1. **날짜 선택**
   - 날짜 피커로 조회 날짜 변경
   - 해당 날짜의 수업이 있는 학생만 표시

2. **진행률 카드**
   - 전체 출석 체크 진행률 (%)
   - 체크 완료 / 전체
   - 출석 / 결석 / 보강 통계

3. **일괄 처리**
   - "전체 출석" 버튼: 모든 학생 출석 처리
   - "미체크만 출석" 버튼: 미체크 학생만 출석

4. **시간대별 그룹핑**
   - 수업 시간별로 학생 그룹화
   - 각 그룹 접기/펼치기 가능
   - 그룹별 진행률 표시

5. **출석 체크**
   - 출석 / 결석 / 보강 버튼
   - **회차권 자동 차감** (출석 시)
   - 남은 횟수 경고 (≤2회)
   - 소진 경고 (0회)

6. **수업 일지 자동 팝업**
   - 출석 체크 후 수업 일지 모달 자동 표시
   - AI 메모 생성 가능

7. **이번 주 보강 예정**
   - 하단에 이번 주 보강 수업 목록
   - 완료 처리 버튼

#### 회차권 차감 로직

**코드 참조**: `AttendanceScreen.js:213-232`

```javascript
// 출석 처리 시
if (status === 'present' && fullStudent?.ticketType === 'count') {
  const currentCount = fullStudent.ticketCount || 0;

  if (currentCount <= 0) {
    toast.warning('회차권이 모두 소진되었습니다!');
  } else {
    const newCount = currentCount - 1;
    await updateStudent(studentId, { ticketCount: newCount });

    if (newCount === 0) {
      toast.warning('회차권이 모두 소진되었습니다!');
    } else if (newCount <= 2) {
      toast.warning(`남은 횟수: ${newCount}회`);
    }
  }
}
```

#### Firebase 저장

```javascript
await AttendanceRepository.create({
  studentId,
  studentName,
  date: formatDate(selectedDate),
  status: 'present' | 'absent' | 'makeup',
  note: ''
});
```

### 6.4 알림장 시스템

#### 6.4.1 알림장 목록 (`NoticeListScreen.js`)

**주요 기능**:
- 발송한 알림장 목록
- 확인 현황 표시 (읽음/전체)
- 날짜/시간 표시
- 상세 보기
- 새 알림장 작성 버튼

#### 6.4.2 알림장 작성 (`NoticeCreateScreen.js`)

**작성 프로세스**:

1. **템플릿 선택**
   ```
   📝 발표회
   📅 휴강 안내
   💰 수강료
   ✏️ 직접 입력
   ```

2. **AI 요청 (선택)**
   - 요청 내용 입력
   - "AI로 작성하기" 버튼
   - Google Gemini가 제목 + 내용 생성
   - "더 친절하게" / "더 간결하게" 개선 버튼

3. **사진/동영상 첨부 (선택)**
   - 갤러리에서 선택 또는 카메라 촬영
   - 최대 5개
   - 미리보기 썸네일
   - 개별 삭제 가능

4. **수신자 선택**
   - 학생 목록 표시
   - 필터링 (카테고리, 요일)
   - 개별 선택 / 전체 선택
   - 선택된 학생 수 표시

5. **발송**
   - Firebase Storage에 미디어 업로드
   - Firestore에 알림장 저장
   - **푸시 알림 자동 전송**
   - 활동 로그 기록

**AI 통합** (`geminiService.js`):
```javascript
const result = await generateNoticeContent(prompt, templateType);
// returns: { success, title, content }
```

**코드 참조**:
- AI 생성: `NoticeCreateScreen.js:120-158`
- 미디어 업로드: `NoticeCreateScreen.js:226-244`
- 발송: `NoticeCreateScreen.js:214-306`

#### 6.4.3 알림장 상세 (`NoticeDetailScreen.js`)

**표시 정보**:
1. **발송 정보**
   - 발송일시
   - 확인 현황 (읽음/전체)

2. **내용**
   - 제목
   - 본문
   - 첨부 미디어 (3열 그리드)

3. **미확인 학부모**
   - 읽지 않은 학생/학부모 목록
   - 이름, 연락처 표시
   - 주황색 경고 박스

4. **댓글 섹션**
   - 학부모가 작성한 댓글
   - 선생님 답글
   - 실시간 업데이트
   - 댓글 삭제 (본인만)

**액션 버튼**:
- "미확인자에게 재발송" (향후 구현)
- "목록으로 돌아가기"
- 수정 / 삭제

**코드 참조**:
- 미확인 학부모: `NoticeDetailScreen.js:184-212`
- 댓글 섹션: `NoticeDetailScreen.js:214-220`

### 6.5 수업 일지

**파일**: `src/screens/teacher/LessonNoteScreen.js`

#### 주요 기능

1. **목록 조회**
   - 전체 수업 일지 목록
   - 학생별 필터링
   - 날짜별 정렬

2. **수업 일지 작성** (`LessonNoteModal.js`)
   ```
   - 학생 선택
   - 날짜 선택
   - 진도 입력
   - 연습 과제 입력
   - 메모 입력 (AI 생성 가능)
   ```

3. **AI 메모 생성**
   - "AI 메모 생성" 버튼
   - 진도와 연습 과제 기반으로 자동 생성
   - Google Gemini 활용

4. **출석 체크 연동**
   - 출석 체크 후 자동으로 수업 일지 모달 표시
   - 빠른 기록 가능

**AI 메모 생성 로직** (`geminiService.js`):
```javascript
const result = await generateLessonMemo({
  studentName,
  progress,
  practice
});
// returns: { success, memo }
```

**코드 참조**:
- 수업 일지 모달: `src/components/teacher/LessonNoteModal.js`
- AI 생성: `LessonNoteModal.js:85-120`

### 6.6 수강료 관리

#### 6.6.1 미수금 학생 (`UnpaidStudentsScreen.js`)

**주요 기능**:
- 이번 달 미납 학생 목록
- 총 미수금 금액
- 학생별 상세 정보:
  - 이름, 레벨
  - 미납 금액
  - 학부모 연락처
  - 전화 걸기 버튼

**필터링**:
- 카테고리별
- 금액 순 정렬

#### 6.6.2 수강료 관리 (`TuitionScreen.js`)

**주요 기능**:
- 전체 수강료 내역
- 월별 조회
- 납부/미납 필터
- 수강료 입력/수정

### 6.7 통계

**파일**: `src/screens/teacher/StatisticsScreen.js`

**제공 통계**:
1. **출석률**
   - 월별 출석률 그래프
   - 학생별 출석률

2. **수강료 현황**
   - 월별 수입 그래프
   - 납부율

3. **학생 현황**
   - 레벨별 분포
   - 카테고리별 분포
   - 요일별 분포

### 6.8 기타 기능

#### 프로필 (`ProfileScreen.js`)
- 선생님 정보 조회/수정
- 학원 정보
- 로그아웃

---

## 7. 학부모 기능

### 7.1 홈 대시보드

**파일**: `src/screens/parent/HomeScreen.js`

**주요 정보**:
1. **자녀 정보 요약**
   - 이름, 레벨
   - 수업 일정
   - 남은 회차 (회차권인 경우)

2. **이번 주 출석**
   - 출석 / 결석 현황
   - 출석률

3. **최근 알림장**
   - 최근 3개 알림장
   - 읽지 않은 알림장 강조

4. **다음 수업**
   - 다음 수업 날짜/시간

### 7.2 출석 조회

**파일**: `src/screens/parent/AttendanceScreen.js`

**주요 기능**:
1. **월별 출석 현황**
   - 달력 뷰
   - 출석 / 결석 / 보강 표시
   - 출석률 통계

2. **출석 히스토리**
   - 날짜별 출석 기록
   - 메모 확인

### 7.3 알림장

**파일**: `src/screens/parent/NoticeScreen.js`

#### 주요 기능

1. **알림장 목록**
   - 전체 알림장 카드
   - 읽음/안읽음 구분
   - **NEW 배지** (안읽은 알림장)
   - 보라색 테두리 (안읽음)

2. **읽지 않은 알림장 배너**
   - 상단에 카운트 표시
   - "읽지 않은 알림장이 N개 있습니다"

3. **알림장 상세 모달**
   - 제목, 내용
   - 첨부 미디어 (3열 그리드)
   - 발송 날짜/시간
   - **자동 읽음 처리**

4. **댓글 작성**
   - 댓글 목록 (실시간)
   - 댓글 작성 (500자 제한)
   - 선생님 답글 확인
   - 본인 댓글 삭제

5. **Pull to Refresh**
   - 아래로 당겨서 새로고침

**자동 읽음 처리** (`NoticeScreen.js:49-62`):
```javascript
const handleNoticePress = async (notice) => {
  setSelectedNotice(notice);
  setShowDetailModal(true);

  if (!notice.isRead) {
    await markNoticeAsRead(notice.id, studentId);
    loadNotices(); // 목록 새로고침
  }
};
```

**코드 참조**:
- 읽음 확인: `NoticeScreen.js:27-46`
- 댓글 섹션: `NoticeScreen.js:251-255`

### 7.4 수업 일지

**파일**: `src/screens/parent/LessonNoteScreen.js`

**주요 기능**:
- 자녀의 수업 일지 조회
- 날짜별 진도 확인
- 연습 과제 확인
- 선생님 메모 확인

### 7.5 기타 기능

#### 자녀 정보 (`ChildInfoScreen.js`)
- 기본 정보
- 수업 일정
- 수강권 정보

#### 수강료 (`TuitionScreen.js`)
- 납부 내역 조회
- 이번 달 납부 현황

#### 진도 현황 (`ProgressScreen.js`)
- 학습 진도 차트 (향후 구현)
- 목표 달성률

#### 갤러리 (`GalleryScreen.js`)
- 학원 행사 사진
- 발표회 사진 등

---

## 8. 서비스 및 API

### 8.1 firestoreService.js

**파일**: `src/services/firestoreService.js` (약 1600줄)

#### 8.1.1 학생 관리

```javascript
// 전체 학생 목록
export const getAllStudents = async (teacherId, options = {})

// 학생 상세 조회
export const getStudentById = async (studentId)

// 학생 추가
export const createStudent = async (studentData, teacherId)

// 학생 수정
export const updateStudent = async (studentId, studentData)

// 학생 삭제
export const deleteStudent = async (studentId)
```

#### 8.1.2 출석 관리

```javascript
// 출석 기록 생성
export const createAttendance = async (attendanceData, teacherId)

// 날짜별 출석 조회
export const getAttendanceByDate = async (teacherId, date)

// 학생별 출석 조회
export const getAttendanceByStudent = async (studentId, options = {})

// 출석 통계
export const getAttendanceStats = async (teacherId, startDate, endDate)
```

#### 8.1.3 수업 일지

```javascript
// 수업 일지 생성
export const createLessonNote = async (lessonNoteData, teacherId)

// 수업 일지 조회
export const getLessonNotes = async (teacherId, options = {})

// 학생별 수업 일지
export const getLessonNotesByStudent = async (studentId, options = {})

// 수업 일지 수정
export const updateLessonNote = async (lessonNoteId, lessonNoteData)
```

#### 8.1.4 알림장 관리

```javascript
// 알림장 생성
export const createNotice = async (noticeData, teacherId)

// 알림장 목록
export const getAllNotices = async (teacherId, options = {})

// 알림장 상세
export const getNoticeById = async (noticeId)

// 알림장 삭제
export const deleteNotice = async (noticeId)

// 읽음 처리
export const markNoticeAsRead = async (noticeId, studentId)

// 학생별 알림장 조회 (학부모용)
export const getNoticesForStudent = async (studentId, teacherId = null)

// 안읽은 알림장 조회
export const getUnreadNotices = async (studentId, teacherId)
```

#### 8.1.5 댓글 관리

```javascript
// 댓글 작성
export const createComment = async (noticeId, commentData)

// 댓글 목록
export const getCommentsByNotice = async (noticeId)

// 댓글 삭제
export const deleteComment = async (commentId)

// 댓글 실시간 구독
export const subscribeToComments = (noticeId, callback)
```

#### 8.1.6 Firebase Storage

```javascript
// 단일 미디어 업로드
export const uploadMedia = async (uri, folder, fileName, onProgress = null)

// 여러 미디어 일괄 업로드
export const uploadMultipleMedia = async (mediaItems, folder, onProgress = null)

// 미디어 삭제
export const deleteMedia = async (downloadURL)
```

### 8.2 geminiService.js

**파일**: `src/services/geminiService.js`

#### 8.2.1 AI 메모 생성

```javascript
/**
 * 수업 일지 메모 자동 생성
 * @param {Object} data - { studentName, progress, practice }
 * @returns {Promise<Object>} { success, memo }
 */
export const generateLessonMemo = async (data)
```

**사용 예**:
```javascript
const result = await generateLessonMemo({
  studentName: "홍길동",
  progress: "체르니 30번 5번",
  practice: "체르니 30번 6번, 스케일 연습"
});

// result.memo: "오늘 홍길동 학생은 체르니 30번 5번을 학습했습니다..."
```

#### 8.2.2 알림장 생성

```javascript
/**
 * 알림장 내용 자동 생성
 * @param {string} prompt - 사용자 요청
 * @param {string} templateType - 템플릿 유형
 * @returns {Promise<Object>} { success, title, content }
 */
export const generateNoticeContent = async (prompt, templateType = null)
```

**사용 예**:
```javascript
const result = await generateNoticeContent(
  "12월 25일 오후 2시에 학원 연주홀에서 발표회를 합니다",
  "발표회"
);

// result.title: "[발표회 안내]"
// result.content: "안녕하세요, 학부모님..."
```

#### 8.2.3 알림장 개선

```javascript
/**
 * 알림장 내용 개선
 * @param {string} content - 원본 내용
 * @param {string} direction - 'friendly' | 'concise'
 * @returns {Promise<Object>} { success, content }
 */
export const improveNoticeContent = async (content, direction)
```

### 8.3 pushNotificationService.js

**파일**: `src/services/pushNotificationService.js`

#### 8.3.1 푸시 토큰 관리

```javascript
// 푸시 알림 권한 요청 및 토큰 등록
export const registerForPushNotifications = async ()

// 푸시 토큰 Firestore 저장
export const savePushToken = async (userId, token, userType = 'parent')
```

#### 8.3.2 알림 전송

```javascript
// 푸시 알림 전송
export const sendPushNotification = async (pushTokens, notification)

// 알림장 발송 알림
export const sendNoticeNotification = async (studentIds, noticeTitle)

// 댓글 작성 알림
export const sendCommentNotification = async (
  noticeId,
  commenterName,
  recipientId,
  recipientType = 'teacher'
)
```

**사용 예**:
```javascript
// 알림장 발송 시
await sendNoticeNotification(
  ['student1', 'student2'],
  '[발표회 안내] 12월 25일 발표회'
);

// 학부모 디바이스에 푸시 알림:
// 제목: "새 알림장이 도착했어요 📝"
// 내용: "[발표회 안내] 12월 25일 발표회"
```

#### 8.3.3 알림 리스너

```javascript
// 알림 리스너 설정
export const setupNotificationListeners = (onNotification, onNotificationResponse)
```

### 8.4 기타 서비스

#### authService.js
```javascript
export const login = async (email, password)
export const signupTeacher = async (email, password, userData)
export const signupParent = async (email, password, userData)
export const logout = async ()
export const resetPassword = async (email)
```

#### dashboardService.js
```javascript
export const getDashboardStats = async (teacherId)
export const getTodayClasses = async (teacherId)
export const getUnpaidStudents = async (teacherId)
export const getRecentActivities = async (teacherId, limit = 5)
```

---

## 9. 상태 관리

**디렉토리**: `src/store/`

### 9.1 authStore.js

```javascript
const useAuthStore = create((set) => ({
  user: null,
  isAuthenticated: false,
  loading: true,

  setUser: (user) => set({
    user,
    isAuthenticated: true,
    loading: false
  }),

  clearUser: () => set({
    user: null,
    isAuthenticated: false,
    loading: false
  }),

  setLoading: (loading) => set({ loading }),
}));
```

### 9.2 studentStore.js

```javascript
const useStudentStore = create((set, get) => ({
  students: [],
  loading: false,
  error: null,

  fetchStudents: async () => {
    set({ loading: true });
    const result = await StudentRepository.getAll();
    set({ students: result.data, loading: false });
  },

  addStudent: async (studentData) => {
    const result = await StudentRepository.create(studentData);
    if (result.success) {
      set({ students: [...get().students, result.data] });
    }
  },

  updateStudent: async (id, studentData) => {
    const result = await StudentRepository.update(id, studentData);
    if (result.success) {
      set({
        students: get().students.map(s =>
          s.id === id ? { ...s, ...studentData } : s
        )
      });
    }
  },

  deleteStudent: async (id) => {
    const result = await StudentRepository.delete(id);
    if (result.success) {
      set({ students: get().students.filter(s => s.id !== id) });
    }
  },
}));
```

### 9.3 attendanceStore.js

```javascript
const useAttendanceStore = create((set) => ({
  attendanceData: [],
  loading: false,

  fetchAttendance: async (date) => {
    set({ loading: true });
    const result = await AttendanceRepository.getByDate(date);
    set({ attendanceData: result.data, loading: false });
  },

  createAttendance: async (attendanceData) => {
    const result = await AttendanceRepository.create(attendanceData);
    return result;
  },
}));
```

### 9.4 noticeStore.js

```javascript
const useNoticeStore = create((set) => ({
  notices: [],
  loading: false,

  fetchNotices: async () => {
    set({ loading: true });
    const result = await NoticeRepository.getAll();
    set({ notices: result.data, loading: false });
  },

  createNotice: async (noticeData) => {
    set({ loading: true });
    const result = await NoticeRepository.create(noticeData);
    set({ loading: false });
    return result;
  },
}));
```

### 9.5 lessonNoteStore.js

```javascript
const useLessonNoteStore = create((set) => ({
  lessonNotes: [],
  loading: false,

  fetchLessonNotes: async () => {
    set({ loading: true });
    const result = await LessonNoteRepository.getAll();
    set({ lessonNotes: result.data, loading: false });
  },

  createLessonNote: async (noteData) => {
    const result = await LessonNoteRepository.create(noteData);
    return result;
  },
}));
```

### 9.6 toastStore.js

```javascript
const useToastStore = create((set) => ({
  toasts: [],

  success: (message) => {
    set((state) => ({
      toasts: [...state.toasts, { type: 'success', message, id: Date.now() }]
    }));
  },

  error: (message) => {
    set((state) => ({
      toasts: [...state.toasts, { type: 'error', message, id: Date.now() }]
    }));
  },

  warning: (message) => {
    set((state) => ({
      toasts: [...state.toasts, { type: 'warning', message, id: Date.now() }]
    }));
  },

  info: (message) => {
    set((state) => ({
      toasts: [...state.toasts, { type: 'info', message, id: Date.now() }]
    }));
  },

  removeToast: (id) => {
    set((state) => ({
      toasts: state.toasts.filter(t => t.id !== id)
    }));
  },
}));
```

---

## 10. 설치 및 설정

### 10.1 환경 요구사항

- **Node.js**: v18 이상
- **npm**: v9 이상
- **Expo CLI**: 최신 버전
- **iOS Simulator** 또는 **Android Emulator** (개발용)
- **Expo Go** 앱 (실제 디바이스 테스트용)

### 10.2 설치 방법

```bash
# 1. 저장소 클론
git clone <repository-url>
cd piano-academy-app

# 2. 의존성 설치
npm install

# 3. 환경변수 설정 (.env 파일 생성)
cp .env.example .env

# 4. 개발 서버 실행
npm start
```

### 10.3 환경변수 설정

**파일**: `.env`

```env
# Firebase Configuration
EXPO_PUBLIC_FIREBASE_API_KEY=your_api_key
EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
EXPO_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
EXPO_PUBLIC_FIREBASE_APP_ID=your_app_id

# Google Gemini API
EXPO_PUBLIC_GEMINI_API_KEY=your_gemini_api_key

# Expo Project
EXPO_PUBLIC_PROJECT_ID=your_expo_project_id
```

### 10.4 Firebase 설정

#### 10.4.1 Firebase 프로젝트 생성

1. [Firebase Console](https://console.firebase.google.com/) 접속
2. 새 프로젝트 생성
3. 웹 앱 추가
4. 구성 정보를 `.env`에 복사

#### 10.4.2 Firestore 설정

1. Firestore Database 생성 (테스트 모드)
2. 보안 규칙 설정:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 학생 컬렉션
    match /students/{studentId} {
      allow read, write: if request.auth != null;
    }

    // 출석 컬렉션
    match /attendance/{attendanceId} {
      allow read, write: if request.auth != null;
    }

    // 알림장 컬렉션
    match /notices/{noticeId} {
      allow read, write: if request.auth != null;
    }

    // 댓글 컬렉션
    match /comments/{commentId} {
      allow read, write: if request.auth != null;
    }

    // 기타 컬렉션도 동일
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

#### 10.4.3 Firebase Storage 설정

1. Storage 생성
2. 보안 규칙 설정:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

#### 10.4.4 Firebase Authentication 설정

1. Authentication 활성화
2. 이메일/비밀번호 로그인 활성화
3. (선택) 비밀번호 재설정 이메일 템플릿 커스터마이징

### 10.5 Google Gemini API 설정

1. [Google AI Studio](https://makersuite.google.com/app/apikey) 접속
2. API 키 생성
3. `.env`의 `EXPO_PUBLIC_GEMINI_API_KEY`에 입력

### 10.6 개발 서버 실행

```bash
# Expo 개발 서버 시작
npm start

# 옵션:
# - iOS 시뮬레이터: npm run ios
# - Android 에뮬레이터: npm run android
# - 웹 브라우저: npm run web
```

### 10.7 빌드 및 배포

#### iOS 빌드 (Apple Developer 계정 필요)

```bash
# EAS Build 설치
npm install -g eas-cli

# EAS 로그인
eas login

# 프로젝트 설정
eas build:configure

# iOS 빌드
eas build --platform ios
```

#### Android 빌드

```bash
# Android APK 빌드
eas build --platform android --profile preview
```

---

## 11. 주요 기능 구현 세부사항

### 11.1 회차권 시스템

#### 11.1.1 회차권 자동 차감

**파일**: `src/screens/teacher/AttendanceScreen.js:213-232`

**로직**:
1. 출석 체크 시 학생의 `ticketType` 확인
2. `ticketType === 'count'`인 경우만 차감
3. `ticketCount - 1` 후 Firestore 업데이트
4. 남은 횟수에 따라 토스트 메시지 표시:
   - 0회: "회차권이 모두 소진되었습니다!"
   - ≤2회: "남은 횟수: N회" (경고)
   - >2회: "출석 체크 완료 (남은 횟수: N회)"

#### 11.1.2 회차권 충전

**파일**: `src/screens/teacher/StudentDetailScreen.js:290-320`

**기능**:
- Quick 충전 버튼: +4회, +8회, +12회
- 현재 횟수에 추가
- Firestore 즉시 업데이트
- 토스트 메시지: "회차권 N회가 충전되었습니다"

#### 11.1.3 회차권 타입 변경

**파일**: `src/screens/teacher/StudentDetailScreen.js:220-265`

**기능**:
- 회차권 ↔ 기간권 전환
- 회차권: 횟수 입력
- 기간권: 시작일/종료일 입력
- 유효성 검사 후 Firestore 업데이트

### 11.2 알림장 시스템

#### 11.2.1 Phase 1: 읽음 확인

**구현 파일**:
- Backend: `firestoreService.js:659-790`
- 학부모: `NoticeScreen.js`
- 선생님: `NoticeDetailScreen.js`

**데이터 구조**:
```javascript
{
  readBy: [
    { studentId: 'student1', readAt: '2025-10-22T10:30:00Z' },
    { studentId: 'student2', readAt: '2025-10-22T11:15:00Z' }
  ],
  confirmed: 2,  // 읽은 학생 수
  total: 5       // 전체 수신자 수
}
```

**읽음 처리**:
```javascript
// 학부모가 알림장 열람 시 자동 실행
await markNoticeAsRead(noticeId, studentId);

// Firestore 업데이트:
// 1. readBy 배열에 { studentId, readAt } 추가
// 2. confirmed 카운트 +1
```

**미확인 학부모 표시**:
```javascript
// 선생님 상세 화면
const unreadStudents = recipients.filter(
  id => !readBy.some(r => r.studentId === id)
);
// 미확인 학부모 이름, 연락처 표시
```

#### 11.2.2 Phase 2: 사진/동영상 첨부

**구현 파일**:
- 컴포넌트: `MediaPicker.js`
- 업로드: `firestoreService.js:1387-1472`
- 작성 화면: `NoticeCreateScreen.js:620-636`

**업로드 프로세스**:
1. 사용자가 이미지/비디오 선택 (최대 5개)
2. 발송 버튼 클릭
3. **먼저 Firebase Storage에 업로드**:
   ```javascript
   const result = await uploadMultipleMedia(
     selectedMedia,
     'notices',
     (progress) => setUploadProgress(progress)
   );
   ```
4. **업로드 완료 후 URL 배열 받기**:
   ```javascript
   uploadedMediaUrls = [
     { url: 'https://...', type: 'image' },
     { url: 'https://...', type: 'video' }
   ];
   ```
5. **Firestore에 알림장 저장** (URL 포함)

**표시**:
- 3열 그리드 레이아웃
- 비디오는 재생 아이콘 오버레이
- 탭하면 전체 화면 보기 (향후 구현)

#### 11.2.3 Phase 3: 댓글 시스템

**구현 파일**:
- 컴포넌트: `CommentSection.js`
- Backend: `firestoreService.js:1373-1482`

**실시간 구독**:
```javascript
useEffect(() => {
  const unsubscribe = subscribeToComments(noticeId, (comments) => {
    setComments(comments);
  });

  return () => unsubscribe();
}, [noticeId]);
```

**Firestore Snapshot Listener**:
- 댓글 추가/삭제 시 자동 업데이트
- 모든 사용자에게 실시간 반영

**댓글 작성**:
```javascript
await createComment(noticeId, {
  userId: user.uid,
  userName: user.name,
  userType: 'parent',
  content: newComment
});
```

**댓글 삭제**:
- 본인의 댓글만 삭제 가능
- `userId` 확인 후 삭제 버튼 표시

### 11.3 AI 통합 (Google Gemini)

#### 11.3.1 수업 일지 AI 메모

**파일**: `geminiService.js:130-180`

**프롬프트**:
```javascript
const prompt = `
당신은 피아노 선생님입니다. 다음 정보를 바탕으로
학부모님께 전달할 간단한 수업 일지 메모를 작성해주세요.

학생: ${studentName}
진도: ${progress}
연습 과제: ${practice}

요구사항:
1. 2-3문장으로 간결하게
2. 친근하고 긍정적인 어조
3. 학부모가 이해하기 쉽게
4. 이모지 사용 자제
`;
```

**API 호출**:
```javascript
const model = genAI.getGenerativeModel({
  model: "gemini-1.5-flash"
});

const result = await model.generateContent(prompt);
const memo = result.response.text();
```

#### 11.3.2 알림장 AI 생성

**파일**: `geminiService.js:200-280`

**프롬프트 예시** (발표회):
```javascript
const prompt = `
피아노 학원 선생님이 학부모님들께 보낼 알림장을 작성해주세요.

내용: ${userPrompt}
템플릿: 발표회 안내

요구사항:
1. 제목과 본문을 구분하여 작성
2. 정중하고 친근한 어조
3. 중요 정보는 명확하게
4. 200-300자 정도
5. 이모지 1-2개만 사용

형식:
제목: [발표회 안내]
본문: 안녕하세요, 학부모님...
`;
```

**개선 기능** ("더 친절하게" / "더 간결하게"):
```javascript
const improvePrompt = `
다음 알림장 내용을 ${direction === 'friendly' ? '더 친절하고 따뜻한 어조로' : '더 간결하고 핵심만'}
수정해주세요.

원본:
${content}
`;
```

### 11.4 푸시 알림

#### 11.4.1 토큰 등록

**파일**: `pushNotificationService.js:33-82`

**프로세스**:
1. **권한 확인**:
   ```javascript
   const { status } = await Notifications.getPermissionsAsync();
   ```

2. **권한 요청** (없는 경우):
   ```javascript
   await Notifications.requestPermissionsAsync();
   ```

3. **Expo Push Token 가져오기**:
   ```javascript
   const token = await Notifications.getExpoPushTokenAsync({
     projectId: process.env.EXPO_PUBLIC_PROJECT_ID
   });
   ```

4. **Firestore에 저장**:
   ```javascript
   await updateDoc(userRef, {
     pushToken: token.data,
     pushTokenUpdatedAt: new Date()
   });
   ```

#### 11.4.2 알림 전송

**파일**: `pushNotificationService.js:145-190`

**Expo Push API 호출**:
```javascript
const messages = pushTokens.map(token => ({
  to: token,
  sound: 'default',
  title: '새 알림장이 도착했어요 📝',
  body: noticeTitle,
  data: { type: 'notice', screen: 'NoticeScreen' },
  badge: 1,
}));

const response = await fetch('https://exp.host/--/api/v2/push/send', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify(messages),
});
```

#### 11.4.3 통합

**알림장 발송 시** (`NoticeCreateScreen.js:292-299`):
```javascript
// 알림장 저장 후
await sendNoticeNotification(selectedStudents, previewTitle);
```

**댓글 작성 시** (`CommentSection.js` - 향후 통합 예정):
```javascript
await sendCommentNotification(
  noticeId,
  user.name,
  recipientId,
  recipientType
);
```

### 11.5 실시간 데이터 동기화

#### 11.5.1 Firestore Snapshot Listeners

**댓글 실시간 구독** (`CommentSection.js:29-36`):
```javascript
useEffect(() => {
  const unsubscribe = subscribeToComments(noticeId, (comments) => {
    setComments(comments);
  });

  return () => unsubscribe();
}, [noticeId]);
```

**Firestore 리스너** (`firestoreService.js:1460-1482`):
```javascript
export const subscribeToComments = (noticeId, callback) => {
  const q = query(
    collection(db, 'comments'),
    where('noticeId', '==', noticeId),
    orderBy('createdAt', 'asc')
  );

  return onSnapshot(q, (snapshot) => {
    const comments = [];
    snapshot.forEach((doc) => {
      comments.push({ id: doc.id, ...doc.data() });
    });
    callback(comments);
  });
};
```

**장점**:
- 새 댓글 즉시 표시
- 별도의 polling 불필요
- 모든 사용자에게 동시 반영

---

## 12. 향후 개발 계획

### 12.1 Phase 4: 발표회/시험 관리

#### 기능
- 발표회 일정 등록
- 참가 학생 관리
- 곡 목록 관리
- 리허설 일정
- 학부모 초대장
- 사진/동영상 갤러리

#### 데이터 구조
```typescript
events: {
  id: string,
  teacherId: string,
  type: 'recital' | 'exam',
  title: string,
  date: string,
  time: string,
  location: string,
  participants: Array<{
    studentId: string,
    repertoire: string[]
  }>,
  photos: string[],
  videos: string[]
}
```

### 12.2 고급 통계 및 분석

#### 기능
- 학생별 성장 차트
- 출석률 추이 그래프
- 수강료 예측
- 레슨 효율성 분석
- 커리큘럼 진도율

#### 차트 라이브러리
- `react-native-chart-kit` (이미 설치됨)
- 월별/분기별/연도별 통계

### 12.3 학부모-학생 연결 시스템

#### 현재 상태
- 임시로 `user.studentId` 사용
- 학부모-학생 관계가 Firestore에 명시적으로 저장되지 않음

#### 개선 방안
1. **초대 코드 시스템**
   ```
   - 선생님이 학생 등록 시 고유 코드 생성
   - 학부모가 회원가입 시 코드 입력
   - Firestore에 관계 저장
   ```

2. **데이터 구조**
   ```typescript
   parents: {
     id: string,
     email: string,
     name: string,
     children: string[]  // 학생 ID 배열
   }

   students: {
     ...existing,
     parentId: string
   }
   ```

### 12.4 알림 개선

#### Push 알림 확장
- [ ] 출석 체크 알림 (학부모)
- [ ] 수강료 납부 알림 (D-3, D-1, D-Day)
- [ ] 보강 수업 리마인더
- [ ] 발표회 D-7 알림

#### 앱 내 알림
- [ ] 알림 센터 구현
- [ ] 알림 읽음/안읽음 관리
- [ ] 알림 필터링

### 12.5 UX 개선

#### 오프라인 모드
- AsyncStorage로 로컬 캐싱
- 네트워크 재연결 시 동기화
- 오프라인 상태 UI 표시

#### 다크 모드
- 다크 테마 지원
- 시스템 설정 연동

#### 접근성
- 스크린 리더 지원
- 폰트 크기 조절
- 고대비 모드

### 12.6 결제 통합

#### PG 연동 (향후)
- Toss Payments / KakaoPay
- 학부모가 앱에서 직접 수강료 결제
- 자동 납부 내역 기록

### 12.7 백업 및 복구

#### 데이터 백업
- Firestore Export 스케줄링
- 학생 데이터 CSV 내보내기
- 알림장 PDF 변환

#### 데이터 복구
- 백업에서 복원
- 실수로 삭제한 데이터 복구 (30일 내)

### 12.8 다국어 지원

#### i18n 통합
- 한국어 (기본)
- 영어
- 중국어 (간체)

### 12.9 웹 버전

#### 선생님 웹 대시보드
- React Web 또는 Next.js
- 더 큰 화면에서 통계 확인
- 대량 데이터 입력/수정

---

## 부록 A: 주요 화면 목록

### 선생님 화면 (16개)

| 화면 | 파일명 | 설명 |
|------|--------|------|
| 대시보드 | `DashboardScreen.js` | 오늘의 출석, 미수금, 통계 |
| 학생 목록 | `StudentListScreen.js` | 전체 학생 목록, 검색/필터 |
| 학생 추가/수정 | `StudentFormScreen.js` | 학생 정보 입력 |
| 학생 상세 | `StudentDetailScreen.js` | 학생 정보, 출석, 수강료 |
| 출석 체크 | `AttendanceScreen.js` | 출석 체크, 회차권 차감 |
| 오늘 수업 | `TodayClassesScreen.js` | 오늘 수업 학생 목록 |
| 보강 수업 | `MakeupClassesScreen.js` | 보강 수업 관리 |
| 알림장 목록 | `NoticeListScreen.js` | 발송한 알림장 목록 |
| 알림장 작성 | `NoticeCreateScreen.js` | AI 기반 알림장 작성 |
| 알림장 상세 | `NoticeDetailScreen.js` | 알림장 내용, 댓글, 읽음 확인 |
| 수업 일지 | `LessonNoteScreen.js` | 수업 일지 목록/작성 |
| 미수금 관리 | `UnpaidStudentsScreen.js` | 미납 학생 목록 |
| 수강료 관리 | `TuitionScreen.js` | 수강료 내역 |
| 통계 | `StatisticsScreen.js` | 출석률, 수입 통계 |
| 프로필 | `ProfileScreen.js` | 선생님 정보 |
| 갤러리 | `GalleryScreen.js` | 학원 행사 사진 |

### 학부모 화면 (8개)

| 화면 | 파일명 | 설명 |
|------|--------|------|
| 홈 | `HomeScreen.js` | 자녀 정보, 출석, 알림장 요약 |
| 자녀 정보 | `ChildInfoScreen.js` | 자녀 상세 정보 |
| 출석 조회 | `AttendanceScreen.js` | 출석 히스토리 |
| 알림장 | `NoticeScreen.js` | 알림장 목록, 댓글 |
| 수업 일지 | `LessonNoteScreen.js` | 수업 일지 열람 |
| 수강료 | `TuitionScreen.js` | 납부 내역 |
| 진도 현황 | `ProgressScreen.js` | 학습 진도 (향후 구현) |
| 갤러리 | `GalleryScreen.js` | 학원 행사 사진 |

### 인증 화면 (7개)

| 화면 | 파일명 | 설명 |
|------|--------|------|
| 스플래시 | `SplashScreen.js` | 로딩 화면 |
| 역할 선택 | `RoleSelectScreen.js` | 선생님/학부모 선택 |
| 로그인 | `LoginScreen.js` | 이메일/비밀번호 로그인 |
| 선생님 회원가입 | `SignupTeacherScreen.js` | 선생님 정보 입력 |
| 학부모 회원가입 | `SignupParentScreen.js` | 학부모 정보 입력 |
| 비밀번호 찾기 | `FindPasswordScreen.js` | 비밀번호 재설정 |
| 공통 회원가입 | `SignupScreen.js` | (미사용) |

---

## 부록 B: 주요 컴포넌트

### 공통 컴포넌트 (`src/components/common/`)

| 컴포넌트 | 파일명 | 설명 |
|----------|--------|------|
| Text | `Text.js` | 기본 텍스트 컴포넌트 |
| Button | `Button.js` | 버튼 |
| FormInput | `FormInput.js` | 입력 필드 |
| MediaPicker | `MediaPicker.js` | 이미지/비디오 선택 |
| CommentSection | `CommentSection.js` | 댓글 섹션 |
| DatePickerModal | `DatePickerModal.js` | 날짜 선택 모달 |
| ScreenHeader | `ScreenHeader.js` | 화면 헤더 |
| Toast | `Toast.js` | 토스트 메시지 |
| BottomSheet | `BottomSheet.js` | 하단 시트 |
| EmptyState | `EmptyState.js` | 빈 상태 UI |

### 선생님 컴포넌트 (`src/components/teacher/`)

| 컴포넌트 | 파일명 | 설명 |
|----------|--------|------|
| StudentCard | `StudentCard.js` | 학생 카드 |
| LessonNoteCard | `LessonNoteCard.js` | 수업 일지 카드 |
| LessonNoteModal | `LessonNoteModal.js` | 수업 일지 작성 모달 |
| NoticeTemplateSelector | `NoticeTemplateSelector.js` | 알림장 템플릿 선택 |
| NoticeRecipientSelector | `NoticeRecipientSelector.js` | 수신자 선택 |

---

## 부록 C: 코드 컨벤션

### 파일 명명 규칙

- **화면**: `PascalCase` + `Screen.js` (예: `DashboardScreen.js`)
- **컴포넌트**: `PascalCase` (예: `StudentCard.js`)
- **서비스**: `camelCase` + `Service.js` (예: `authService.js`)
- **스토어**: `camelCase` + `Store.js` (예: `studentStore.js`)
- **유틸**: `camelCase` (예: `formatDate.js`)

### 변수 명명 규칙

- **컴포넌트**: PascalCase (예: `StudentCard`)
- **함수**: camelCase (예: `fetchStudents`)
- **상수**: UPPER_SNAKE_CASE (예: `FIREBASE_VERSION`)
- **boolean**: `is`, `has`, `should` 접두사 (예: `isLoading`, `hasError`)

### Import 순서

```javascript
// 1. React & React Native
import React, { useState, useEffect } from 'react';
import { View, Text } from 'react-native';

// 2. 외부 라이브러리
import { SafeAreaView } from 'react-native-safe-area-context';
import { Ionicons } from '@expo/vector-icons';

// 3. 프로젝트 컴포넌트
import { Button, FormInput } from '../../components/common';

// 4. 서비스 & 스토어
import { useStudentStore, useToastStore } from '../../store';
import { authService } from '../../services/authService';

// 5. 스타일 & 상수
import TEACHER_COLORS from '../../styles/teacher_colors';
```

### 주석 규칙

```javascript
/**
 * 함수 설명
 * @param {string} param1 - 파라미터 설명
 * @returns {Promise<Object>} 반환값 설명
 */
export const functionName = async (param1) => {
  // 구현
};
```

---

## 부록 D: 트러블슈팅

### 일반적인 문제

#### 1. Firebase 연결 오류

**증상**: "Firebase initialization error"

**해결**:
```bash
# .env 파일 확인
# Firebase 콘솔에서 설정 값 재확인
# 개발 서버 재시작
npm start -- --reset-cache
```

#### 2. 푸시 알림이 작동하지 않음

**증상**: "푸시 알림 모듈을 불러올 수 없습니다"

**해결**:
- Expo Go에서는 푸시 알림 비활성화 (정상)
- 실제 디바이스에서 테스트 필요
- Development Build 생성:
  ```bash
  eas build --profile development
  ```

#### 3. 이미지 업로드 실패

**증상**: "미디어 업로드 실패"

**해결**:
- Firebase Storage 규칙 확인
- 파일 크기 제한 확인 (최대 10MB)
- 네트워크 연결 확인

#### 4. 출석 체크 시 학생 카드 사라짐

**증상**: 출석 버튼 클릭 후 카드 사라짐

**해결**: ✅ 수정 완료 (`AttendanceScreen.js:143-168`)
- useEffect 의존성 문제 해결
- 출석 상태 유지 로직 추가

---

## 부록 E: 성능 최적화

### 이미 적용된 최적화

1. **useMemo / useCallback**
   - 학생 목록 필터링 (`StudentListScreen.js`)
   - 출석 그룹핑 (`AttendanceScreen.js`)

2. **실시간 구독 정리**
   - useEffect cleanup function
   - 메모리 누수 방지

3. **이미지 최적화**
   - 업로드 시 quality: 0.8
   - 썸네일 생성 (향후)

4. **Lazy Loading**
   - 화면별 코드 스플리팅
   - React Navigation 기본 지원

### 향후 최적화 계획

1. **React.memo**
   - StudentCard, LessonNoteCard 등

2. **FlatList 최적화**
   - windowSize 조정
   - getItemLayout 구현

3. **이미지 캐싱**
   - React Native Fast Image

4. **Firestore 쿼리 최적화**
   - 인덱스 추가
   - 쿼리 제한 (limit)

---

## 문서 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2025-10-22 | 1.0 | 초안 작성 | Development Team |

---

## 연락처

- **개발팀**: development@piano-academy.com
- **기술 지원**: support@piano-academy.com
- **GitHub**: https://github.com/piano-academy/app

---

**문서 끝**
